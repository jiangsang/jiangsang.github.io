---
layout: post
title: 【树莓派】利用花生壳内网穿透使外网可访问
categories:
 - 好玩的
 - 计算机网络
tags:
 - 树莓派
 - 内网穿透
---

按照前两篇文章，树莓派配置安装好后，就能在局域网内使用SSH登录树莓派，然后进行命令行的操作。我在上面安装了Aria2-ui，自然希望不仅局限于在局域网内使用，而是只要有网就能访问，就像是一个微型服务器，随时可访问。而要实现类似需求，可以统一用一个解决方案:内网穿透。

<!-- more -->

### 什么是内网穿透

---

内网穿透，即Network address translation，它是一种将一个IP地址空间重新映射到另一个IP地址空间的方法。它的功能就是进行端口映射，用在树莓派上就可以用以实现公网访问本属于内网的树莓派。

实现内网穿透的方式有很多，比如FRP，ngrok等。各有优缺点吧，FRP需要一个VPS以进行转发，我使用花生壳后觉得该方法简单易上手且免费；缺点是不是很稳定，有时候连接不上。



### 树莓派安装花生壳

[花生壳 3.0 for 树莓派 安装使用攻略](http://service.oray.com/question/2680.html)，官方攻略已经挺全了。



### 花生壳配置

树莓派安装完成后根据给出的SN码和初始密码admin登录花生壳，如果已经有花生壳的账户了，可以绑定在一起。**接下来是重点-添加内网穿透配置。**网页端和手机端都有花生壳管理客户端可添加

![](https://article-1300776923.file.myqcloud.com/%E6%A0%91%E8%8E%93%E6%B4%BE/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F_1.png)

进入内网穿透编辑页面，点击添加，必要字段说明：

- 应用类型：要使用SSH连接选择TCP，需要WEB访问选择HTTP
- 外网域名：注册后花生壳赠送的域名；
- 外网端口：字面意思
- 内网主机：树莓派的内网IP地址，可以在路由器中将IP与MAC地址绑定，这样IP地址就不会变了
- 内网端口：就是树莓派中相关服务使用的端口了，例如22端口是默认用于SSH连接的。



![](https://article-1300776923.file.myqcloud.com/%E6%A0%91%E8%8E%93%E6%B4%BE/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F_2.JPG)

大功告成，我的树莓派80端口是File Browser（安装aria2-ui时）在使用 ，将访问地址输入到浏览器页面就能看到服务了（记得断开WIFI使用移动网络试），只能映射两条。

> 注意：除了80端口，外网端口的其他端口并不能指定，只能选择随机端口

![](https://article-1300776923.file.myqcloud.com/%E6%A0%91%E8%8E%93%E6%B4%BE/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F_3.JPG)

### 可能遇到的问题

- 配置完成后访问不了，可能是路由器设置的原因，我之前在路由器里也登录了花生壳，导致了冲突，需要断开

![](https://article-1300776923.file.myqcloud.com/%E6%A0%91%E8%8E%93%E6%B4%BE/%E8%B7%AF%E7%94%B1%E5%99%A8%E8%AE%BE%E7%BD%AE.JPG)

- 多地登录导致无法访问，电脑上不要安装花生壳！！！，在电脑上也安装了花生壳客户端的话电脑关闭就访问不了了，即使树莓派上也安装了。如果不慎安装了，那么卸载掉电脑上的，然后在树莓派上输入`qhddns restart`重启花生壳。

